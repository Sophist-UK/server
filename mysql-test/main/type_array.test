--echo #
--echo # MDEV-32380 Array data type for stored routnes
--echo #

# Testing that ARRAY is not a reserved keyword

CREATE TABLE array (array INT);
INSERT INTO array (array) VALUES (1);
UPDATE array SET array=Array+1;
SELECT array Array FROM array;
SELECT array[array,array]=array[2,2] FROM array;
DROP TABLE array;

DELIMITER $$;
BEGIN NOT ATOMIC
  DECLARE array int array[2] DEFAULT array[1,2];
  SELECT array[1,2]=array;
  SELECT array=array[`array`[1],`array`[2]];
END;
$$
DELIMITER ;$$


# Testing various operations

--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT 1[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT 10.1[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT 10.1e0[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT 'test'[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT 0x6061[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT TRUE[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT NULL[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT ROW(1,2)[1];

--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT (1)[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT (ROW(1,2))[1];
--error ER_ILLEGAL_PARAMETER_DATA_TYPE_FOR_OPERATION
SELECT (1 IS NULL)[1];

--error ER_PARSE_ERROR
SELECT 1 IS NULL [1];
--error ER_PARSE_ERROR
SELECT _latin1'a' COLLATE latin1_bin [1];

--error ER_NOT_SUPPORTED_YET
SELECT (SELECT 1 FROM DUAL)[0];

--error ER_NOT_SUPPORTED_YET
SELECT ARRAY[1,2][1];

SELECT ARRAY[1,2,3]=ARRAY[1,2,3];
EXPLAIN EXTENDED SELECT array[1,2,3]=array[1,2,3];
#TODO
#SELECT ARRAY[1,2,3]<ARRAY[1,2,3];


--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ARRAY[1,2,3]=123;
--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ARRAY[1,2,3]='1,2,3';

--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ROW(1,2,3)=ARRAY[1,2,3];
--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ARRAY[1,2,3]=ROW(1,2,3);

# TODO: a better error message
--error ER_OPERAND_COLUMNS
SELECT ARRAY[1,2,3];
--error ER_OPERAND_COLUMNS
CREATE TABLE t1 AS SELECT ARRAY[1,2,3];

--error ER_OPERAND_COLUMNS
SELECT NOT ARRAY[1,2,3];

--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ARRAY[1,2,3] + ARRAY[1,2,3];
--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ARRAY[1,2,3] - ARRAY[1,2,3];
--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ARRAY[1,2,3] * ARRAY[1,2,3];
--error ER_ILLEGAL_PARAMETER_DATA_TYPES2_FOR_OPERATION
SELECT ARRAY[1,2,3] / ARRAY[1,2,3];

--error ER_OPERAND_COLUMNS
EXECUTE IMMEDIATE 'SELECT ARRAY[1,2,3] = ?' USING ARRAY[1,2,3];
