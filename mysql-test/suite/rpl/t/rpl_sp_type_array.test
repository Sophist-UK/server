source include/master-slave.inc;

disable_query_log;
call mtr.add_suppression("Unsafe statement written to the binary log using statement format since BINLOG_FORMAT = STATEMENT");
enable_query_log;

--echo #
--echo # MDEV-32380 Array data type for stored routnes
--echo #

connection master;
CREATE TABLE t1 (a INT);
DELIMITER $$;
CREATE PROCEDURE p1()
BEGIN
  DECLARE a INT ARRAY[3];
  DECLARE i1 INT ARRAY[3] DEFAULT ARRAY[1,2,3];
  DECLARE i2 INT ARRAY[3] DEFAULT ARRAY[1,2,3];
  FOR i IN 1..3 DO
    SET a[i]= i*10;
  END FOR;
  FOR i IN 1..3 DO
    INSERT INTO t1 VALUES (a[i]);
  END FOR;
  FOR i IN 1..3 DO
    SET a[i]=i;
    INSERT INTO t1 (SELECT i*100+1 UNION SELECT i*100+2 UNION SELECT i*100+3)
      LIMIT a[i];
  END FOR;
  FOR i IN 1..3 DO
    SET a[i]=i;
    INSERT INTO t1 (SELECT i*100+11 UNION SELECT i*100+12 UNION SELECT i*100+13)
      LIMIT a[i1[i2[COALESCE(i,3)]]];
  END FOR;
END;
$$
DELIMITER ;$$
# Suppres "Unsafe statement written to the binary log"
--disable_warnings
CALL p1;
--enable_warnings
SELECT * FROM t1;
sync_slave_with_master;
SELECT * FROM t1;
connection master;
DROP PROCEDURE p1;
DROP TABLE t1;
sync_slave_with_master;

--source include/rpl_end.inc
